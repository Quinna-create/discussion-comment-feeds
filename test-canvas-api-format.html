<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Canvas API Format</title>
    <link rel="stylesheet" href="widget-style.css">
</head>
<body>
    <h1>Test Canvas API Format</h1>
    <p>This tests the widget with Canvas API format data (view array)</p>
    
    <div id="discussion-widget" class="widget-container">
        <div class="comment-bubble">
            <div id="commentContent" class="comment-content">
                <div class="loading">Loading comments...</div>
            </div>
            <div class="comment-meta">
                <span id="authorName" class="author-name"></span>
                <span id="commentDate" class="comment-date"></span>
            </div>
        </div>
        <!-- Hidden elements for compatibility -->
        <span id="currentIndex" style="display:none;">0</span>
        <span id="totalComments" style="display:none;">0</span>
        <button id="pauseBtn" style="display:none;"></button>
        <button id="prevBtn" style="display:none;"></button>
        <button id="nextBtn" style="display:none;"></button>
        <input type="number" id="cycleInterval" style="display:none;" value="15">
    </div>

    <script>
    // Override fetch to simulate Canvas API response
    const originalFetch = window.fetch;
    window.fetch = function(url, options) {
        console.log('Intercepted fetch to:', url);
        
        // Simulate Canvas API response with 'view' array
        if (url.includes('/api/discussions')) {
            return Promise.resolve({
                ok: true,
                status: 200,
                json: () => Promise.resolve({
                    view: [
                        {
                            id: 1,
                            message: "This is a test post from Canvas API format",
                            user: {
                                display_name: "Test User 1",
                                avatar_image_url: "https://via.placeholder.com/32"
                            },
                            created_at: "2024-01-15T10:30:00Z"
                        },
                        {
                            id: 2,
                            message: "Another post in Canvas API format with view array",
                            user: {
                                display_name: "Test User 2",
                                avatar_image_url: "https://via.placeholder.com/32"
                            },
                            created_at: "2024-01-15T14:20:00Z"
                        },
                        {
                            id: 3,
                            message: "Third post testing nested user object",
                            user: {
                                display_name: "Test User 3",
                                avatar_image_url: "https://via.placeholder.com/32"
                            },
                            created_at: "2024-01-16T09:15:00Z"
                        }
                    ]
                })
            });
        }
        
        // For other requests, use original fetch
        return originalFetch.apply(this, arguments);
    };
    
    // Configuration
    window.discussionWidgetConfig = {
        replitApiUrl: 'https://canvas-discuss-quinna2.replit.app',
        courseId: '196700',
        discussionId: '6735506',
        cycleInterval: 5000, // 5 seconds for faster testing
        maxComments: 50
    };
    </script>
    <script src="widget-script.js"></script>
</body>
</html>
